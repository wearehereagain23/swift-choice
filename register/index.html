<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Swift Choice ‚Äì Sign Up</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />

	<style>
		body {
			margin: 0;
			font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
			background: #f2f6f7;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
		}

		.container {
			display: flex;
			flex-direction: column;
			width: 100%;
			max-width: 1000px;
			background: #fff;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 6px 18px rgba(0, 0, 0, .15);
		}

		/* ===============================
     Welcome Panel
  ================================ */
		.welcome-panel {
			background: linear-gradient(135deg, #0a798f, #06537c);
			color: #fff;
			text-align: center;
			padding: 40px 20px;
		}

		.welcome-panel img {
			width: 60px;
			margin-bottom: 15px;
		}

		.welcome-panel h2 {
			font-size: 24px;
			margin: 10px 0;
		}

		.welcome-panel p {
			font-size: 14px;
			line-height: 1.5;
			max-width: 420px;
			margin: 0 auto;
		}

		/* ===============================
     Form Panel
  ================================ */
		.form-panel {
			padding: 40px 30px;
		}

		.form-panel h2 {
			text-align: center;
			color: #0a828f;
			margin-bottom: 30px;
			font-size: 22px;
		}

		/* Default: single column */
		form {
			display: grid;
			grid-template-columns: 1fr;
			gap: 18px;
		}

		.row {
			display: block;
			width: 100%;
		}

		.full-width {
			grid-column: 1 / -1;
		}

		/* Desktop: 2 columns */
		@media (min-width: 1024px) {
			form {
				grid-template-columns: 1fr 1fr;
				gap: 20px 24px;
			}

			.full-width {
				grid-column: span 2;
			}
		}

		/* ===============================
     Inputs & Buttons
  ================================ */
		input,
		select,
		button {
			width: 100%;
			padding: 12px 14px;
			border-radius: 12px;
			border: 1px solid #d4d7dc;
			font-size: 14px;
			box-sizing: border-box;
			height: 46px;
			line-height: 1.2;
			background-color: #fff;
			color: #111827;
		}

		input:focus,
		select:focus {
			border-color: #0a608f;
			outline: none;
			box-shadow: 0 0 0 2px rgba(10, 105, 143, 0.15);
		}

		button {
			background: #0a868f;
			color: #fff;
			border: none;
			font-size: 15px;
			cursor: pointer;
			transition: background .2s;
		}

		button:hover {
			background: #06577c;
		}

		/* ===============================
     Normalize iOS Select & Date
  ================================ */
		select,
		input[type="date"],
		input[type="time"],
		input[type="datetime-local"] {
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
			background-color: #fff;
			border: 1px solid #d4d7dc;
			border-radius: 12px;
			padding-right: 40px;
			/* space for icon */
			background-position: right 12px center;
			background-repeat: no-repeat;
			background-size: 16px;
		}

		/* Custom arrow for select */
		select {
			background-image: url("data:image/svg+xml;utf8,<svg fill='%230a8f4d' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
		}

		/* Custom calendar icon for date */
		input[type="date"] {
			background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' fill='%230a8f4d' viewBox='0 0 24 24' width='20' height='20'><path d='M7 2v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-2V2h-2v2H9V2H7zm12 18H5V9h14v11z'/></svg>");
		}

		/* Hide iOS default calendar/arrow */
		input[type="date"]::-webkit-inner-spin-button,
		input[type="date"]::-webkit-calendar-picker-indicator {
			-webkit-appearance: none;
			display: none;
		}

		/* ===============================
     Date Placeholder Trick
  ================================ */
		input[type="date"]:not(:focus):invalid::before {
			content: attr(placeholder);
			color: #9ca3af;
			/* gray placeholder */
		}

		input[type="date"]:focus::before,
		input[type="date"]:valid::before {
			content: "";
		}

		/* ===============================
     Helpers
  ================================ */
		.muted {
			color: #475569;
			font-size: 13px;
			text-align: center;
			grid-column: 1 / -1;
		}

		.link {
			color: #0a798f;
			text-decoration: none;
		}

		.link:hover {
			text-decoration: underline;
		}

		.footer {
			margin-top: 25px;
			font-size: 13px;
			text-align: center;
			color: #666;
			grid-column: 1 / -1;
		}

		.footer strong {
			display: block;
			margin-bottom: 5px;
			font-size: 14px;
			color: #0a798f;
		}

		/* ===============================
     Fields, Errors & Hints
  ================================ */
		.field {
			display: flex;
			flex-direction: column;
			gap: 6px;
		}

		.error {
			color: #b91c1c;
			font-size: 12px;
			min-height: 14px;
		}

		.hint {
			color: #64748b;
			font-size: 12px;
		}

		/* ===============================
     Password Strength
  ================================ */
		.strength-wrap {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.strength-bar {
			flex: 1;
			height: 8px;
			border-radius: 8px;
			background: #e5e7eb;
			overflow: hidden;
		}

		.strength-bar>div {
			height: 100%;
			width: 0%;
			transition: width .25s;
		}

		.strength-label {
			font-size: 12px;
			color: #334155;
			width: 70px;
			text-align: right;
		}

		/* ===============================
     Spinner Modal
  ================================ */
		#spinnerModal {
			position: fixed;
			inset: 0;
			background: rgba(255, 255, 255, .8);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 9999;
		}

		.spinner {
			border: 5px solid #f3f3f3;
			border-top: 5px solid #0a698f;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			animation: spin 1s linear infinite;
		}

		@keyframes spin {
			100% {
				transform: rotate(360deg);
			}
		}
	</style>




</head>

<body>
	<div class="container">
		<div class="welcome-panel">
			<img src="../icon-512.png" alt="Swift Choice Logo" />
			<h2>Join Swift Choice</h2>
			<p>Create your account and enjoy secure, seamless banking at your fingertips.</p>
		</div>

		<div class="form-panel">
			<h2>Create Account</h2>

			<form id="signupForm" novalidate>
				<div class="row">
					<div class="field">
						<input id="firstname" name="firstname" type="text" placeholder="First Name" required />
						<div class="error" id="firstnameErr"></div>
					</div>
					<div class="field">
						<input id="middlename" name="middlename" type="text" placeholder="Middle Name" />
						<div class="error" id="middlenameErr"></div>
					</div>
				</div>

				<div class="row">
					<div class="field">
						<input id="lastname" name="lastname" type="text" placeholder="Last Name" required />
						<div class="error" id="lastnameErr"></div>
					</div>
					<div class="field full-width">
						<input id="email" name="email" type="email" placeholder="Email" class="full-width" required />
						<div class="error" id="emailErr"></div>
					</div>
				</div>

				<div class="row">
					<div class="field">
						<div class="date-wrapper">
							<label for="birth">Date of Birth</label>
							<input id="birth" name="birth" type="date" placeholder="Date of Birth" required>

						</div>
						<div class="error" id="birthErr"></div>
					</div>
					<div class="field">
						<select id="gender" name="gender" required>
							<option value="">Select Gender</option>
							<option>Male</option>
							<option>Female</option>
						</select>
						<style>
							.date-wrapper {
								position: relative;
							}

							.date-wrapper input {
								width: 100%;
								padding: 8px;
							}

							.date-wrapper .placeholder {
								position: absolute;
								left: 12px;
								top: 50%;
								transform: translateY(-50%);
								color: #888;
								pointer-events: none;
							}

							.date-wrapper input:valid+.placeholder,
							.date-wrapper input:focus+.placeholder {
								display: none;
							}
						</style>
						<div class="error" id="genderErr"></div>
					</div>
				</div>

				<div class="row">
					<div class="field">
						<select id="country" name="country" type="text" placeholder="Country" required>
							<option value="">-- Country --
							</option>
							<option value="United Kingdom">
								United Kingdom</option>
							<option value="United States of America">
								United States of America
							</option>
							<option value="Argentina">
								Argentina</option>
							<option value="Australia">
								Australia</option>
							<option value="Austria">
								Austria</option>
							<option value="Belgium">
								Belgium</option>
							<option value="Bolivia">
								Bolivia</option>
							<option value="Bosnia &amp; Herzegovina">
								Bosnia &amp; Herzegovina
							</option>
							<option value="Brazil">
								Brazil</option>
							<option value="Bulgaria">
								Bulgaria</option>
							<option value="Canada">
								Canada</option>
							<option value="Chile">Chile
							</option>
							<option value="China">China
							</option>
							<option value="Croatia">
								Croatia</option>
							<option value="Cyprus">
								Cyprus</option>
							<option value="Czech Republic">
								Czech Republic</option>
							<option value="Denmark">
								Denmark</option>
							<option value="Finland">
								Finland</option>
							<option value="France">
								France</option>
							<option value="Georgia">
								Georgia</option>
							<option value="Germany">
								Germany</option>
							<option value="Greece">
								Greece</option>
							<option value="Hong Kong">
								Hong Kong</option>
							<option value="Hungary">
								Hungary</option>
							<option value="Iceland">
								Iceland</option>
							<option value="India">India
							</option>
							<option value="Indonesia">
								Indonesia</option>
							<option value="Iran">Iran
							</option>
							<option value="Iraq">Iraq
							</option>
							<option value="Ireland">
								Ireland</option>
							<option value="Israel">
								Israel</option>
							<option value="Italy">Italy
							</option>
							<option value="Jamaica">
								Jamaica</option>
							<option value="Japan">Japan
							</option>
							<option value="Korea North">
								Korea North</option>
							<option value="Korea Sout">
								Korea South</option>
							<option value="Lesotho">
								Lesotho</option>
							<option value="Luxembourg">
								Luxembourg</option>
							<option value="Maldives">
								Maldives</option>
							<option value="Mexico">
								Mexico</option>
							<option value="Monaco">
								Monaco</option>
							<option value="Netherlands">
								Netherlands (Holland,
								Europe)</option>
							<option value="Norway">
								Norway</option>
							<option value="Oman">Oman
							</option>
							<option value="Paraguay">
								Paraguay</option>
							<option value="Peru">Peru
							</option>
							<option value="Poland">
								Poland</option>
							<option value="Portugal">
								Portugal</option>
							<option value="Qatar">Qatar
							</option>
							<option value="Republic of Serbia">
								Republic of Serbia
							</option>
							<option value="Romania">
								Romania</option>
							<option value="Russia">
								Russia</option>
							<option value="Serbia">
								Serbia</option>
							<option value="Singapore">
								Singapore</option>
							<option value="Slovakia">
								Slovakia</option>
							<option value="Slovenia">
								Slovenia</option>
							<option value="Spain">Spain
							</option>
							<option value="Sweden">
								Sweden</option>
							<option value="Switzerland">
								Switzerland</option>
							<option value="Thailand">
								Thailand</option>
							<option value="Turkey">
								Turkey</option>
							<option value="Ukraine">
								Ukraine</option>
							<option value="United Arab Erimates">
								United Arab Emirates
							</option>
							<option value="Uraguay">
								Uruguay</option>
							<option value="Vietnam">
								Vietnam</option>
							<option value="Yemen">Yemen
							</option>
							<option value="Zaire">Zaire
							</option>
						</select>
						<div class="error" id="countryErr"></div>
					</div>
					<div class="field">
						<input id="city" name="city" type="text" placeholder="City" required />
						<div class="error" id="cityErr"></div>
					</div>
				</div>

				<div class="row">
					<div class="field">
						<select id="accounttype" name="accounttype" required>
							<option value="">Account Type</option>

							<option value="Online">
								Online Account</option>
							<option value="Savings">
								Savings Account</option>
							<option value="Checking">
								Checking Account
							</option>
							<option value="Current">
								Current Account</option>
							<option value="Corporate">
								Corporate Account
							</option>
							<option value="Offshore">
								Offshore Account
							</option>
							<option value="Joint">Joint
								Account</option>
						</select>
						<div class="error" id="accounttypeErr"></div>
					</div>
					<div class="field">
						<select id="currency" name="currency" required>
							<option value="">Currency</option>
							<option value="$">US Dollar
								($)</option>
							<option value="&pound;">
								Pound Sterling (&#163;)
							</option>
							<option value="&#128;">Euro
								(&#128;)</option>
							<option value="&#165;">
								Japanese Yen (&#165;)
							</option>
						</select>
						<div class="error" id="currencyErr"></div>
					</div>
				</div>

				<div class="row">
					<div class="field">
						<input id="password" name="password" type="password" placeholder="Password"
							autocomplete="new-password" required />
						<div class="strength-wrap">
							<div class="strength-bar">
								<div id="strengthFill"></div>
							</div>
							<div class="strength-label" id="strengthLabel">Weak</div>
						</div>
						<div class="hint">Use 8+ chars with upper, lower, number, special.</div>
						<div class="error" id="passwordErr"></div>
					</div>
					<div class="field">
						<input id="password2" name="password2" type="password" placeholder="Confirm Password"
							autocomplete="new-password" required />
						<div class="error" id="password2Err"></div>
					</div>
				</div>

				<div class="field full-width">
					<input type="text" id="pin" name="pin" maxlength="4" pattern="\d{4}" inputmode="numeric"
						placeholder="Enter 4-digit PIN" required
						oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 4)">
					<div class="error" id="pinErr"></div>
				</div>

				<button id="submitBtn" type="submit" class="full-width">Sign Up</button>

				<p class="muted">Have an account? <a id="Switcher" class="link">Sign in</a></p>
			</form>

			<div class="footer">
				<strong>No Hidden Fees</strong>
				Stay updated with text alerts, email notifications, online access, or call our 24/7 friendly support
				team.
			</div>
		</div>
	</div>

	<!-- SPINNER DIV -->
	<div id="spinnerModal" class="spinner-modal" style="display: none;">
		<div class="spinner-content">
			<div class="spinner"></div>
			<p>Loading, please wait...</p>
		</div>
	</div>
	<!-- SPINNER DIV -->

	<!-- SPINNER CSS -->
	<style>
		.spinner-modal {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.6);
			backdrop-filter: blur(5px);
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 9999;
		}

		.spinner-content {
			text-align: center;
			color: white;
		}

		.spinner {
			border: 6px solid #f3f3f3;
			border-top: 6px solid #ffffff;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			animation: spin 1s linear infinite;
			margin: 0 auto 10px;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}
	</style>

	<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="../config.js"></script>

	<script>
		// ===== Init Firebase =====
		firebase.initializeApp(CONFIG.FIREBASE);
		const auth = firebase.auth();
		const db = firebase.firestore();

		const urlParams = new URLSearchParams(window.location.search);
		const statusParam = urlParams.get("status");

		let adminPass = null

		document.getElementById("Switcher").addEventListener("click", () => {
			if (statusParam) {
				window.location.href = "../login/index.html?status=none";
			} else {
				window.location.href = "../login/index.html";
			}
		});

		db.collection("admin").doc("admin").get().then((doc) => {
			if (doc.exists) {
				adminPass = doc.data().pass;
			} else {
				console.log("No such document!");
			}
		}).catch((error) => {
			console.error("Error fetching user:", error);
		});

		// ===== UI refs =====
		const form = document.getElementById("signupForm");
		const spinner = document.getElementById("spinnerModal");

		const els = {
			firstname: document.getElementById("firstname"),
			middlename: document.getElementById("middlename"),
			lastname: document.getElementById("lastname"),
			email: document.getElementById("email"),
			birth: document.getElementById("birth"),
			gender: document.getElementById("gender"),
			city: document.getElementById("city"),
			country: document.getElementById("country"),
			accounttype: document.getElementById("accounttype"),
			currency: document.getElementById("currency"),
			password: document.getElementById("password"),
			password2: document.getElementById("password2"),
			pin: document.getElementById("pin"),
		};

		const errs = {
			firstname: document.getElementById("firstnameErr"),
			middlename: document.getElementById("middlenameErr"),
			lastname: document.getElementById("lastnameErr"),
			email: document.getElementById("emailErr"),
			birth: document.getElementById("birthErr"),
			gender: document.getElementById("genderErr"),
			city: document.getElementById("cityErr"),
			country: document.getElementById("countryErr"),
			accounttype: document.getElementById("accounttypeErr"),
			currency: document.getElementById("currencyErr"),
			password: document.getElementById("passwordErr"),
			password2: document.getElementById("password2Err"),
			pin: document.getElementById("pinErr"),
		};

		// ===== Spinner helpers =====
		const showSpinner = () => (spinner.style.display = "flex");
		const hideSpinner = () => (spinner.style.display = "none");

		// ===== Password strength =====
		const strengthFill = document.getElementById("strengthFill");
		const strengthLabel = document.getElementById("strengthLabel");

		function passwordScore(pw) {
			let s = 0;
			if ((pw || "").length >= 8) s++;
			if (/[A-Z]/.test(pw)) s++;
			if (/[a-z]/.test(pw)) s++;
			if (/[0-9]/.test(pw)) s++;
			if (/[^A-Za-z0-9]/.test(pw)) s++;
			return s; // 0‚Äì5
		}
		function updateStrengthMeter(pw) {
			const score = passwordScore(pw);
			const pct = (score / 5) * 100;
			strengthFill.style.width = pct + "%";
			strengthFill.style.background =
				pct < 40 ? "#ef4444" : pct < 80 ? "#f59e0b" : "#22c55e";
			strengthLabel.textContent =
				pct < 40 ? "Weak" : pct < 80 ? "Medium" : "Strong";
			return score;
		}
		updateStrengthMeter("");
		els.password.addEventListener("input", (e) =>
			updateStrengthMeter(e.target.value)
		);

		// ===== Validation =====
		const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
		const required = (v) => String(v || "").trim().length > 0;
		const pinOk = (v) => /^[0-9]{4}$/.test(String(v || "").trim());
		const setErr = (key, msg = "") => {
			errs[key].textContent = msg;
		};

		function validateAll() {
			Object.keys(errs).forEach((k) => setErr(k, ""));

			let ok = true;
			if (!required(els.firstname.value)) {
				setErr("firstname", "First name is required");
				ok = false;
			}
			if (!required(els.lastname.value)) {
				setErr("lastname", "Last name is required");
				ok = false;
			}
			if (!emailRegex.test(els.email.value)) {
				setErr("email", "Enter a valid email");
				ok = false;
			}
			if (!required(els.birth.value)) {
				setErr("birth", "Date of birth is required");
				ok = false;
			}
			if (!required(els.gender.value)) {
				setErr("gender", "Please select gender");
				ok = false;
			}
			if (!required(els.city.value)) {
				setErr("city", "City is required");
				ok = false;
			}
			if (!required(els.country.value)) {
				setErr("country", "Country is required");
				ok = false;
			}
			if (!required(els.accounttype.value)) {
				setErr("accounttype", "Select account type");
				ok = false;
			}
			if (!required(els.currency.value)) {
				setErr("currency", "Select currency");
				ok = false;
			}

			const score = updateStrengthMeter(els.password.value);
			if (score < 3) {
				setErr("password", "Password too weak");
				ok = false;
			}
			if (els.password2.value !== els.password.value) {
				setErr("password2", "Passwords do not match");
				ok = false;
			}

			if (!pinOk(els.pin.value)) {
				setErr("pin", "PIN must be exactly 4 digits");
				ok = false;
			}
			return ok;
		}

		[
			"firstname",
			"lastname",
			"email",
			"birth",
			"gender",
			"city",
			"country",
			"accounttype",
			"currency",
			"password",
			"password2",
			"pin",
		].forEach((id) => els[id].addEventListener("input", validateAll));

		// ===== IP helper =====
		async function getIP() {
			try {
				const r1 = await fetch("https://ipapi.co/json/");
				if (r1.ok) {
					const d1 = await r1.json();
					if (d1?.ip) return d1.ip;
				}
			} catch { }
			try {
				const r2 = await fetch("https://api.ipify.org?format=json");
				if (r2.ok) {
					const d2 = await r2.json();
					if (d2?.ip) return d2.ip;
				}
			} catch { }
			return "";
		}

		// Save subscription under subscribers collection
		async function saveSubscription(uid) {
			const serviceObjStr = localStorage.getItem("serviceObject");
			if (!serviceObjStr) return;

			let serviceObj;
			try {
				serviceObj = JSON.parse(serviceObjStr);
			} catch {
				console.warn("‚ö†Ô∏è Invalid serviceObject in localStorage");
				return;
			}

			if (!serviceObj.endpoint || !serviceObj.keys) {
				console.warn("‚ö†Ô∏è Malformed subscription object, skipping save");
				return;
			}

			// Deduplicate: check if subscription already exists for this user
			const subsRef = db.collection("subscribers");
			const existing = await subsRef
				.where("uuid", "==", uid)
				.where("subscription.endpoint", "==", serviceObj.endpoint)
				.get();

			if (existing.empty) {
				await subsRef.add({
					uuid: uid,
					subscription: serviceObj, // üëà wrapped correctly
					createdAt: firebase.firestore.FieldValue.serverTimestamp(),
				});
				console.log("‚úÖ Subscription saved for user:", uid);
			} else {
				console.log("‚ÑπÔ∏è Subscription already exists for this device");
			}
		}

		// ===== Submit =====
		form.addEventListener("submit", async (e) => {
			e.preventDefault();

			if (!validateAll()) {
				Swal.fire({ customClass: { popup: 'swal2Style' }, title: 'Fix errors', text: 'Please correct the highlighted fields.', icon: 'warning' })
				return;
			}

			showSpinner();

			function genCodes() {
				const accountNumber =
					"937" + Math.floor(1000000 + Math.random() * 9000000);
				const r = (n) => Math.floor(Math.random() * n);
				const IMF = `IMF${r(1795)}wOd${r(105)}HS/A${r(3725)}`;
				const TAX = `TAX${r(170395)}-GNC${r(1905)}XW${r(378825)}`;
				const COT = `OPL${r(1795)}/COT${r(1905)}FVM/${r(3725)}`;
				return { accountNumber, IMF, TAX, COT };
			}

			const { accountNumber, IMF, TAX, COT } = genCodes();

			const payload = {
				firstname: els.firstname.value.trim(),
				middlename: els.middlename.value.trim(),
				lastname: els.lastname.value.trim(),
				city: els.city.value.trim(),
				country: els.country.value.trim(),
				email: els.email.value.trim(),
				password: els.password.value,
				dateOfBirth: els.birth.value,
				gender: els.gender.value,
				accttype: els.accounttype.value,
				currency: els.currency.value,
				pin: String(els.pin.value).trim(),
			};

			try {
				// 1) Register with Firebase Auth
				const cred = await auth.createUserWithEmailAndPassword(
					payload.email,
					els.password.value
				);
				const user = cred.user;
				const uid = user.uid;

				// 2) Get browser IP
				const ip = await getIP();

				// 3) Save user profile to Firestore
				await db.collection("users").doc(uid).set({
					...payload,
					accountLevel: "Starter",
					uuid: uid,
					createdAt: new Date().toISOString(),
					ip,
					auth: "inactive",
					address: "",
					zipcode: "",
					phone: "",
					kinname: "",
					accountNumber,
					IMF,
					TAX,
					COT,
					accountBalance: 0,
					accountTypeBalance: 0,
					loanAmount: 0,
					unsettledLoan: 0,
					loanPhoto: "",
					activeuser: "active",
					kyc: "",
					fixedDate: "",
					loanType: "",
					KYC_image1: "",
					KYC_image2: "",
					KYC_image3: "",
					transferAccess: "allow",
					profileImage: "",
					occupation: "",
					marital_status: "",
					kin_email: "",
					cards: "no",
					cardApproval: "",
					expireDate: "00/00",
					cardNumber: "0000",
					businessName: "",
					businessAddress: "",
					businessDes: "",
					monthlyIncome: "",
					gurantorName: "",
					gurantorContact: "",
					notificationCount: "0",
					adjustAccountLevel: "Starter",
					loanApprovalStatus: "",
				});

				// 4) Save subscriber
				await saveSubscription(uid);

				// 5) Send welcome email
				const formData = {
					email: payload.email,
					name: payload.firstname,
					bank: "Swift Choice",
					host: 'mail.assistin.online',
					adminEmail: 'swiftchoice@assistin.online',
					pass: adminPass,
					from: '<noreply@assistin.online>',
					image:
						"https://tkolyezukxoefqjzhqar.supabase.co/storage/v1/object/public/logos/IMG_0307.PNG",
				};

				try {
					const res = await fetch(
						"https://api-sender-service-runner.vercel.app/bank/welcome",
						{
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(formData),
						}
					);
					const data = await res.json();
					console.log("üìß Email response:", data);
				} catch (mailErr) {
					console.warn("Email send failed:", mailErr);
				}

				hideSpinner();
				location.href = "../bankDash/index.html";
			} catch (err) {
				hideSpinner();
				console.error(err);
				Swal.fire("‚ùå Error", err.message || "Something went wrong.", "error");
				Swal.fire({ customClass: { popup: 'swal2Style' }, title: '‚ùå Error', text: err.message || "Something went wrong.", icon: 'error' })
			}
		});
	</script>

	<style>
		.swal2Style {
			color: white;
		}

		.swal2-confirm {
			background-color: #006f8b;
		}

		.swal2-popup {
			background-color: #00092c;
		}

		.swal2-confirm:hover {
			background-color: #00313d;
		}
	</style>

</body>

</html>